(function(){let a=window.require("fs"),s=window.require("process"),r=s.platform,o=("win32"===r?s.env.APPDATA:"darwin"===r?s.env.HOME+"/Library/Preferences":process.env.HOME+"/.config")+"/BetterDiscord/",n="localStorage.json",d={};if(a.existsSync(`${o}${n}`))try{d=JSON.parse(a.readFileSync(`${o}${n}`))}catch(h){console.log(h)}else if(a.existsSync(n))try{d=JSON.parse(a.readFileSync(n))}catch(h){console.log(h)}var l=d;l.setItem=function(h,g){l[h]=g,this.save()},l.getItem=function(h){return l[h]||null},l.save=function(){a.writeFileSync(`${o}${n}`,JSON.stringify(this),null,4)};var u=new Proxy(l,{set:function(h,g,b){l[g]=b,l.save()},get:function(h,g){return l[g]||null}});window.localStorage=u})(),(()=>{let a=document.createElement("div");a.className="bd-loaderv2",a.title="BetterDiscord is loading...",document.body.appendChild(a)})(),window.bdStorage={},window.bdStorage.get=function(a){return betterDiscordIPC.sendSync("synchronous-message",{arg:"storage",cmd:"get","var":a})},window.bdStorage.set=function(a,s){betterDiscordIPC.sendSync("synchronous-message",{arg:"storage",cmd:"set","var":a,data:s})},window.bdPluginStorage={},window.bdPluginStorage.get=function(a,s){return betterDiscordIPC.sendSync("synchronous-message",{arg:"pluginstorage",cmd:"get",pn:a,"var":s})},window.bdPluginStorage.set=function(a,s,r){betterDiscordIPC.sendSync("synchronous-message",{arg:"pluginstorage",cmd:"set",pn:a,"var":s,data:r})},betterDiscordIPC.on("asynchronous-reply",(a,s)=>{console.log(a),console.log(s)});var settingsPanel,emoteModule,utils,quickEmoteMenu,voiceMode,pluginModule,themeModule,dMode,publicServersModule,jsVersion=1.792,supportedVersion="0.2.81",bbdVersion="0.0.5",mainObserver,twitchEmoteUrlStart="https://static-cdn.jtvnw.net/emoticons/v1/",twitchEmoteUrlEnd="/1.0",ffzEmoteUrlStart="https://cdn.frankerfacez.com/emoticon/",ffzEmoteUrlEnd="/1",bttvEmoteUrlStart="https://cdn.betterttv.net/emote/",bttvEmoteUrlEnd="/1x",mainCore,settings={"Save logs locally":{id:"bda-gs-0",info:"Saves chat logs locally",implemented:!1,hidden:!1,cat:"core"},"Public Servers":{id:"bda-gs-1",info:"Display public servers button",implemented:!1,hidden:!1,cat:"core"},"Minimal Mode":{id:"bda-gs-2",info:"Hide elements and reduce the size of elements.",implemented:!0,hidden:!1,cat:"core"},"Voice Mode":{id:"bda-gs-4",info:"Only show voice chat",implemented:!0,hidden:!1,cat:"core"},"Hide Channels":{id:"bda-gs-3",info:"Hide channels in minimal mode",implemented:!0,hidden:!1,cat:"core"},"Dark Mode":{id:"bda-gs-5",info:"Make certain elements dark by default(wip)",implemented:!0,hidden:!1,cat:"core"},"Override Default Emotes":{id:"bda-es-5",info:"Override default emotes",implemented:!1,hidden:!1,cat:"core"},"Voice Disconnect":{id:"bda-dc-0",info:"Disconnect from voice server when closing Discord",implemented:!0,hidden:!1,cat:"core"},"Custom css live update":{id:"bda-css-0",info:"",implemented:!0,hidden:!0,cat:"core"},"Custom css auto udpate":{id:"bda-css-1",info:"",implemented:!0,hidden:!0,cat:"core"},"24 Hour Timestamps":{id:"bda-gs-6",info:"Replace 12hr timestamps with proper ones",implemented:!0,hidden:!1,cat:"core"},"Coloured Text":{id:"bda-gs-7",info:"Make text colour the same as role colour",implemented:!0,hidden:!1,cat:"core"},"BetterDiscord Blue":{id:"bda-gs-b",info:"Replace Discord blue with BD Blue",implemented:!0,hidden:!1,cat:"core"},"Developer Mode":{id:"bda-gs-8",info:"Developer Mode",implemented:!0,hidden:!1,cat:"core"},"Startup Error Modal":{id:"fork-ps-1",info:"Show a modal with plugin/theme errors on startup",implemented:!0,hidden:!1,cat:"fork"},"Show Toasts":{id:"fork-ps-2",info:"Shows a small notification for starting and stopping plugins & themes",implemented:!0,hidden:!1,cat:"fork"},"Scroll To Settings":{id:"fork-ps-3",info:"Auto-scrolls to a plugin's settings when the button is clicked (only if out of view)",implemented:!0,hidden:!1,cat:"fork"},"Emote Modifier Tooltip":{id:"fork-es-1",info:"Shows the emote modifier in the tooltip.",implemented:!0,hidden:!1,cat:"fork"},"Animate On Hover":{id:"fork-es-2",info:"Only animate the emote modifiers on hover",implemented:!0,hidden:!1,cat:"fork"},"Copy Selector":{id:"fork-dm-1",info:"Adds a \"Copy Selector\" option to context menus when developer mode is active",implemented:!0,hidden:!1,cat:"fork"},"Twitch Emotes":{id:"bda-es-7",info:"Show Twitch emotes",implemented:!0,hidden:!1,cat:"emote"},"FrankerFaceZ Emotes":{id:"bda-es-1",info:"Show FrankerFaceZ Emotes",implemented:!0,hidden:!1,cat:"emote"},"BetterTTV Emotes":{id:"bda-es-2",info:"Show BetterTTV Emotes",implemented:!0,hidden:!1,cat:"emote"},"Emote Menu":{id:"bda-es-0",info:"Show Twitch/Favourite emotes in emote menu",implemented:!0,hidden:!1,cat:"emote"},"Emoji Menu":{id:"bda-es-9",info:"Show Discord emoji menu",implemented:!0,hidden:!1,cat:"emote"},"Emote Autocomplete":{id:"bda-es-3",info:"Autocomplete emote commands",implemented:!1,hidden:!1,cat:"emote"},"Emote Auto Capitalization":{id:"bda-es-4",info:"Autocapitalize emote commands",implemented:!0,hidden:!1,cat:"emote"},"Show Names":{id:"bda-es-6",info:"Show emote names on hover",implemented:!0,hidden:!1,cat:"emote"},"Show emote modifiers":{id:"bda-es-8",info:"Enable emote mods (flip, spin, pulse, spin2, spin3, 1spin, 2spin, 3spin, tr, bl, br, shake, shake2, shake3, flap)",implemented:!0,hidden:!1,cat:"emote"}},defaultCookie={version:jsVersion,"bda-gs-0":!1,"bda-gs-1":!1,"bda-gs-2":!1,"bda-gs-3":!1,"bda-gs-4":!1,"bda-gs-5":!0,"bda-gs-6":!1,"bda-gs-7":!1,"bda-gs-8":!1,"bda-es-0":!0,"bda-es-1":!0,"bda-es-2":!0,"bda-es-3":!1,"bda-es-4":!1,"bda-es-5":!0,"bda-es-6":!0,"bda-es-7":!0,"bda-gs-b":!0,"bda-es-8":!0,"bda-jd":!0,"bda-dc-0":!1,"bda-css-0":!1,"bda-css-1":!1,"bda-es-9":!0,"fork-dm-1":!1,"fork-ps-1":!0,"fork-ps-2":!0,"fork-ps-3":!0,"fork-es-1":!0,"fork-es-2":!1},settingsCookie={},bdpluginErrors,bdthemeErrors,bdConfig=null;function Core(a){a?a.newLoader=!0:a={branch:"master",repo:"rauenzi",updater:{CDN:"cdn.rawgit.com"}},window.bdConfig=a}Core.prototype.init=function(){function a(){console.log(new Date().getTime()+" Defer"),0<document.querySelectorAll(".guilds .guild").length?(console.log(new Date().getTime()+" Defer Loaded"),s.injectExternals(),utils.log("Initializing EmoteModule"),emoteModule.init(),!bdpluginErrors&&(bdpluginErrors=[]),!bdthemeErrors&&(bdthemeErrors=[]),utils.log("Loading Plugins"),pluginModule=new PluginModule,pluginModule.loadPlugins(),utils.log("Loading Themes"),themeModule=new ThemeModule,themeModule.loadThemes(),$("#customcss").detach().appendTo(document.head),utils.log("Updating Settings"),settingsPanel=new V2_SettingsPanel,settingsPanel.updateSettings(),utils.log("Initializing QuickEmoteMenu"),quickEmoteMenu.init(),window.addEventListener("beforeunload",function(){settingsCookie["bda-dc-0"]&&document.querySelector(".btn.btn-disconnect").click()}),publicServersModule.initialize(),emoteModule.autoCapitalize(),settingsCookie.version<jsVersion&&(settingsCookie.version=jsVersion,s.saveSettings()),utils.log("Removing Loading Icon"),document.getElementsByClassName("bd-loaderv2")[0].remove(),settingsCookie["fork-ps-1"]&&(utils.log("Collecting Startup Errors"),s.showStartupErrors()),utils.log("Initializing Main Observer"),s.initObserver()):setTimeout(a,100)}var s=this,r="undefined"==typeof version?bdVersion:version;return r<supportedVersion?void this.alert("Not Supported","BetterDiscord v"+r+"(your version) is not supported by the latest js("+jsVersion+").<br><br> Please download the latest version from <a href='https://betterdiscord.net' target='_blank'>BetterDiscord.net</a>"):void(utils=new Utils,utils.getHash(),publicServersModule=new V2_PublicServers,emoteModule=new EmoteModule,quickEmoteMenu=new QuickEmoteMenu,voiceMode=new VoiceMode,dMode=new devMode,utils.log("Initializing Settings"),this.initSettings(),$(document).ready(function(){setTimeout(a,1e3)}))},Core.prototype.injectExternals=function(){utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js")},Core.prototype.initSettings=function(){if(void 0==$.cookie("better-discord"))settingsCookie=defaultCookie,this.saveSettings();else for(var a in this.loadSettings(),$("<style id=\"customcss\">").html(atob(window.bdStorage.get("bdcustomcss"))).appendTo(document.head),defaultCookie)void 0==settingsCookie[a]&&(settingsCookie[a]=defaultCookie[a],this.saveSettings())},Core.prototype.saveSettings=function(){$.cookie("better-discord",JSON.stringify(settingsCookie),{expires:365,path:"/"})},Core.prototype.loadSettings=function(){settingsCookie=JSON.parse($.cookie("better-discord"))},Core.prototype.initObserver=function(){let a=this;mainObserver=new MutationObserver(function(s){s.forEach(function(r){if("undefined"!=typeof pluginModule&&pluginModule.rawObserver(r),r.removedNodes.length&&r.removedNodes[0]instanceof Element){let n=r.removedNodes[0];(n.classList.contains("activityFeed-HeiGwL")||"friends"===n.id)&&pluginModule.channelSwitch()}if(r.addedNodes.length&&r.addedNodes[0]instanceof Element){let o=r.addedNodes[0];(o.classList.contains("layer")||o.classList.contains("layer-kosS71"))&&(o.querySelector(".guild-settings-base-section")&&o.setAttribute("layer-id","server-settings"),o.getElementsByClassName("socialLinks-1oZoF3").length&&(o.setAttribute("layer-id","user-settings"),!o.querySelector("#bd-settings-sidebar")&&settingsPanel.renderSidebar())),o.classList.contains("popout")&&!o.classList.contains("popout-left")&&(o.getElementsByClassName("emoji-picker").length||o.getElementsByClassName("emojiPicker-3g68GS").length)&&quickEmoteMenu.obsCallback(o),(o.classList.contains("activityFeed-HeiGwL")||"friends"===o.id)&&pluginModule.channelSwitch(),(o.classList.contains("messages-wrapper")||o.querySelector(".messages-wrapper"))&&(a.inject24Hour(o),a.injectColoredText(o),pluginModule.channelSwitch()),o.classList.contains("message-group")&&(a.inject24Hour(o),a.injectColoredText(o),!o.querySelector(".message-sending")&&o.parentElement&&o.parentElement.children&&o==o.parentElement.children[o.parentElement.children.length-1]&&pluginModule.newMessage()),o.classList.contains("message-text")&&a.injectColoredText(o.parentElement.parentElement.parentElement.parentElement),o.classList.contains("message")&&(a.injectColoredText(o.parentElement.parentElement),!o.classList.contains("message-sending")&&pluginModule.newMessage()),emoteModule.obsCallback(r)}})}),mainObserver.observe(document,{childList:!0,subtree:!0})},Core.prototype.inject24Hour=function(a){settingsCookie["bda-gs-6"]&&a.querySelectorAll(".timestamp").forEach(s=>{if(!s.getAttribute("data-24")){let r=s.innerText||s.textContent,o=/([^0-9]*)([0-9]?[0-9]:[0-9][0-9])([^0-9]*)/.exec(r);if(null!=o&&!(4>o.length)){let n=o[2].split(":"),d=parseInt(n[0]),l=n[1],u=o[3].toLowerCase();u.includes("am")&&12==d?d-=12:u.includes("pm")&&12>d&&(d+=12),d=("0"+d).slice(-2),s.innerText=o[1]+d+":"+l+o[3],s.setAttribute("data-24",o[2])}}})},Core.prototype.remove24Hour=function(a){a.querySelectorAll(".timestamp").forEach(s=>{if(s.getAttribute("data-24")){let r=s.getAttribute("data-24");s.removeAttribute("data-24");let o=s.innerText||s.textContent,n=/([^0-9]*)([0-9]?[0-9]:[0-9][0-9])([^0-9]*)/.exec(o);null==n||4>n.length||(s.innerText=n[1]+r+n[3])}})},Core.prototype.injectColoredText=function(a){settingsCookie["bda-gs-7"]&&a.querySelectorAll(".user-name").forEach(s=>{let r=s.style.color;"rgb(255, 255, 255)"===r||s.closest(".message-group").querySelectorAll(".markup").forEach(o=>{o.getAttribute("data-colour")||(o.setAttribute("data-colour",!0),o.style.setProperty("color",r))})})},Core.prototype.removeColoredText=function(a){a.querySelectorAll(".user-name").forEach(s=>{s.closest(".message-group").querySelectorAll(".markup").forEach(r=>{r.getAttribute("data-colour")&&(r.removeAttribute("data-colour"),r.style.setProperty("color",""))})})},Core.prototype.alert=function(a,s){let r=$(`<div class="bd-modal-wrapper theme-dark">
                    <div class="bd-backdrop backdrop-2ohBEd"></div>
                    <div class="bd-modal modal-2LIEKY">
                        <div class="bd-modal-inner inner-1_1f7b">
                            <div class="header header-3sp3cE">
                                <div class="title">${a}</div>
                            </div>
                            <div class="bd-modal-body">
                                <div class="scroller-wrap fade">
                                    <div class="scroller">
                                        ${s}
                                    </div>
                                </div>
                            </div>
                            <div class="footer footer-1PYmcw">
                                <button type="button">Okay</button>
                            </div>
                        </div>
                    </div>
                </div>`);r.find(".footer button").on("click",()=>{r.addClass("closing"),setTimeout(()=>{r.remove()},300)}),r.find(".bd-backdrop").on("click",()=>{r.addClass("closing"),setTimeout(()=>{r.remove()},300)}),r.appendTo("#app-mount")},Core.prototype.showStartupErrors=function(){function a(o){let n=$(`<div class="errors">`);for(let d of o){let l=$(`<div class="error">
                                <div class="table-column column-name">${d.name?d.name:d.file}</div>
                                <div class="table-column column-reason">${d.reason}</div>
                                <div class="table-column column-error"><a class="error-link" href="">${d.error?d.error.message:""}</a></div>
                            </div>`);n.append(l),d.error&&l.find("a").on("click",u=>{u.preventDefault(),utils.err(`Error details for ${d.name?d.name:d.file}.`,d.error)})}return n}if(bdpluginErrors&&bdthemeErrors&&(bdpluginErrors.length||bdthemeErrors.length)){let s=$(`<div class="bd-modal-wrapper theme-dark">
                    <div class="bd-backdrop backdrop-2ohBEd"></div>
                    <div class="bd-modal bd-startup-modal modal-2LIEKY">
                        <div class="bd-modal-inner inner-1_1f7b">
                            <div class="header header-3sp3cE"><div class="title">Startup Errors</div></div>
                            <div class="bd-modal-body">
                                <div class="tab-bar-container">
                                    <div class="tab-bar TOP">
                                        <div class="tab-bar-item">Plugins</div>
                                        <div class="tab-bar-item">Themes</div>
                                    </div>
                                </div>
                                <div class="table-header">
                                    <div class="table-column column-name">Name</div>
                                    <div class="table-column column-reason">Reason</div>
                                    <div class="table-column column-error">Error</div>
                                </div>
                                <div class="scroller-wrap fade">
                                    <div class="scroller">

                                    </div>
                                </div>
                            </div>
                            <div class="footer footer-1PYmcw">
                                <button type="button">Okay</button>
                            </div>
                        </div>
                    </div>
                </div>`),r=[a(bdpluginErrors),a(bdthemeErrors)];s.find(".tab-bar-item").on("click",o=>{o.preventDefault(),s.find(".tab-bar-item").removeClass("selected"),$(o.target).addClass("selected"),s.find(".scroller").empty().append(r[$(o.target).index()])}),s.find(".footer button").on("click",()=>{s.addClass("closing"),setTimeout(()=>{s.remove()},300)}),s.find(".bd-backdrop").on("click",()=>{s.addClass("closing"),setTimeout(()=>{s.remove()},300)}),s.appendTo("#app-mount"),s.find(".tab-bar-item")[0].click()}},Core.prototype.showToast=function(a,s={}){if(!document.querySelector(".bd-toasts")){let l=document.createElement("div");l.classList.add("bd-toasts");let u=document.querySelector(".chat form, #friends, .noChannel-2EQ0a9, .activityFeed-HeiGwL");l.style.setProperty("left",u?u.getBoundingClientRect().left+"px":"0px"),l.style.setProperty("width",u?u.offsetWidth+"px":"100%"),l.style.setProperty("bottom",(document.querySelector(".chat form")?document.querySelector(".chat form").offsetHeight:80)+"px"),document.querySelector(".app").appendChild(l)}const{type:r="",icon:o=!0,timeout:n=3e3}=s;let d=document.createElement("div");d.classList.add("bd-toast"),r&&d.classList.add("toast-"+r),r&&o&&d.classList.add("icon"),d.innerText=a,document.querySelector(".bd-toasts").appendChild(d),setTimeout(()=>{d.classList.add("closing"),setTimeout(()=>{d.remove(),document.querySelectorAll(".bd-toasts .bd-toast").length||document.querySelector(".bd-toasts").remove()},300)},n)};var emotesFfz={},emotesBTTV={},emotesBTTV2={},emotesTwitch={},subEmotesTwitch={};window.bdEmotes={TwitchGlobal:{},TwitchSubscriber:{},FrankerFaceZ:{},BTTV:{},BTTV2:{}},window.bdEmoteSettingIDs={TwitchGlobal:"bda-es-7",TwitchSubscriber:"bda-es-7",FrankerFaceZ:"bda-es-1",BTTV:"bda-es-2",BTTV2:"bda-es-2"};function EmoteModule(){}EmoteModule.prototype.init=function(){this.modifiers=["flip","spin","pulse","spin2","spin3","1spin","2spin","3spin","tr","bl","br","shake","shake2","shake3","flap"],this.categories=Object.keys(window.bdEmoteSettingIDs);let a={TwitchGlobal:{url:"https://twitchemotes.com/api_cache/v3/global.json",backup:"https://"+bdConfig.updater.CDN+"/"+bdConfig.repo+"/BetterDiscordApp/"+bdConfig.hash+"/data/emotedata_twitch_global.json",variable:"TwitchGlobal",getEmoteURL:s=>`https://static-cdn.jtvnw.net/emoticons/v1/${s.id}/1.0`},TwitchSubscriber:{url:"https://twitchemotes.com/api_cache/v3/subscriber.json",backup:"https://"+bdConfig.updater.CDN+"/"+bdConfig.repo+"/BetterDiscordApp/"+bdConfig.hash+"/data/emotedata_twitch_subscriber.json",variable:"TwitchSubscriber",parser:s=>{let r={};for(let o in s){let n=s[o];for(let u,d=0,l=n.emotes.length;d<l;d++)u=n.emotes[d],r[u.code]=u.id}return r},getEmoteURL:s=>`https://static-cdn.jtvnw.net/emoticons/v1/${s}/1.0`},FrankerFaceZ:{url:"https://"+bdConfig.updater.CDN+"/"+bdConfig.repo+"/BetterDiscordApp/"+bdConfig.hash+"/data/emotedata_ffz.json",variable:"FrankerFaceZ",getEmoteURL:s=>`https://cdn.frankerfacez.com/emoticon/${s}/1`},BTTV:{url:"https://api.betterttv.net/emotes",variable:"BTTV",parser:s=>{let r={};for(let d,o=0,n=s.emotes.length;o<n;o++)d=s.emotes[o],r[d.regex]=d.url;return r},getEmoteURL:s=>`${s}`},BTTV2:{url:"https://"+bdConfig.updater.CDN+"/"+bdConfig.repo+"/BetterDiscordApp/"+bdConfig.hash+"/data/emotedata_bttv.json",variable:"BTTV2",getEmoteURL:s=>`https://cdn.betterttv.net/emote/${s}/1x`}};if(!bdConfig.newLoader){for(let s in window.bdEmotes={TwitchGlobal:emotesTwitch,TwitchSubscriber:subEmotesTwitch,FrankerFaceZ:emotesFfz,BTTV:emotesBTTV,BTTV2:emotesBTTV2},window.bdEmotes)for(let r in window.bdEmotes[s])window.bdEmotes[s][r]=a[s].getEmoteURL(window.bdEmotes[s][r]);return}this.loadEmoteData(a)},EmoteModule.prototype.clearEmoteData=async function(){let a=require("fs"),r=bdConfig.dataPath+"emote_data.json",o=a.existsSync(r);o&&a.unlinkSync(r),window.bdEmotes={TwitchGlobal:{},TwitchSubscriber:{},FrankerFaceZ:{},BTTV:{},BTTV2:{}}},EmoteModule.prototype.loadEmoteData=async function(a){let s=require("fs"),o=bdConfig.dataPath+"emote_data.json",n=s.existsSync(o);if(n&&!bdConfig.cache.expired){mainCore.showToast("Loading emotes from cache.",{type:"info"}),utils.log("[Emotes] Loading emotes from local cache.");let d=s.readFileSync(o,"utf8"),l=this.testJSON(d);for(let u in l&&(bdEmotes=JSON.parse(d)),a)l=0<Object.keys(bdEmotes[a[u].variable]).length;if(l)return void mainCore.showToast("Emotes successfully loaded.",{type:"success"});utils.log("[Emotes] Cache was corrupt, downloading..."),s.unlinkSync(o)}for(let d in mainCore.showToast("Downloading emotes in the background do not reload.",{type:"info"}),a){let l=await this.downloadEmotes(a[d]);bdEmotes[a[d].variable]=l}mainCore.showToast("All emotes successfully downloaded.",{type:"success"});try{s.writeFileSync(o,JSON.stringify(bdEmotes),"utf8")}catch(d){utils.err("[Emotes] Could not save emote data.",d)}quickEmoteMenu.init()},EmoteModule.prototype.downloadEmotes=function(a){let s=require("request"),r={url:a.url,timeout:a.timeout?a.timeout:5e3};return utils.log("[Emotes] Downloading: "+a.variable),new Promise((o,n)=>{s(r,(d,l,u)=>{if(d){if(utils.err("[Emotes] Could not download "+a.variable,d),a.backup)return a.url=a.backup,a.backup=null,this.downloadEmotes(a);n({})}else{let h=JSON.parse(u);for(let g in"function"==typeof a.parser&&(h=a.parser(h)),h)h[g]=a.getEmoteURL(h[g]);o(h)}})})},EmoteModule.prototype.testJSON=function(a){try{JSON.parse(a);return!0}catch(s){return!1}return!1},EmoteModule.prototype.getBlacklist=function(){$.getJSON("https://cdn.rawgit.com/Jiiks/betterDiscordApp/"+_hash+"/data/emotefilter.json",function(a){bemotes=a.blacklist})},EmoteModule.prototype.obsCallback=function(a){for(var o,s=this,r=0;r<a.addedNodes.length;++r)if(o=a.addedNodes.item(r),o){var n=s.getNodes(o);for(var d in n)if(n.hasOwnProperty(d)){var l=n[d].parentElement;l&&l.classList.contains("edited")?s.injectEmote(l):s.injectEmote(n[d])}}},EmoteModule.prototype.getNodes=function(a){for(var s,r=[],o=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,null,!1);s=o.nextNode();)r.push(s);return r};var bemotes=[];EmoteModule.prototype.injectEmote=async function(a){if(a.parentElement&&(a.parentElement.classList.contains("markup")||a.parentElement.classList.contains("message-content"))){let s=document.querySelector(".messages.scroller"),r=a.parentElement,o=r.innerHTML.split(/([^\s]+)([\s]|$)/g).filter(function(n){return n});for(let n=0,d=o.length;n<d;n++){let l=o[n],u=l.split(":"),h=u[0],g=u[1]?u[1]:"";if(!(bemotes.includes(h)||4>h.length)){this.modifiers.includes(g)&&settingsCookie["bda-es-8"]||(g="");for(let D,T=0,N=this.categories.length;T<N;T++)if(D=this.categories[T],settingsCookie[bdEmoteSettingIDs[D]]){let L=bdEmotes[D].hasOwnProperty(h);if(!L)continue;let P=bdEmotes[D][h],A=this.createEmoteElement(h,P,g),j=r.offsetHeight;r.innerHTML=r.innerHTML.replace(new RegExp(`([\\s]|^)${g?h+":"+g:h}([\\s]|$)`,"g"),`$1${A}$2`),s.scrollTop+=r.offsetHeight-j}"[!s]"==l&&r.classList.add("spoiler")}}}},EmoteModule.prototype.createEmoteElement=function(a,s,r){var o=Math.round(a.length/4),n=a.substr(0,o)+"\uFDD9"+a.substr(o,o)+"\uFDD9"+a.substr(2*o,o)+"\uFDD9"+a.substr(3*o),d=settingsCookie["fork-es-2"]?" stop-animation":"",l=r?"emote"+r:"";return("<span class=\"emotewrapper\"><img draggable=\"false\" style=\"max-height:32px;\" data-modifier=\""+r+"\" class=\"emote "+l+d+"\" alt=\""+n+"\" src=\""+s+"\"/><input onclick='quickEmoteMenu.favorite(\""+n+"\", \""+s+"\");' class=\"fav\" title=\"Favorite!\" type=\"button\"></span>").replace(/﷙/g,"")},EmoteModule.prototype.autoCapitalize=function(){var a=this;$("body").delegate($(".channelTextArea-1HTP3C textarea:first"),"keyup change paste",function(){if(settingsCookie["bda-es-4"]){var s=$(".channelTextArea-1HTP3C textarea:first").val();if(void 0!=s){var r=s.split(" ").pop();if(3<r.length){if("danSgame"==r)return;var o=a.capitalize(r.toLowerCase());null!==o&&void 0!==o&&utils.insertText(utils.getTextArea()[0],s.replace(r,o))}}}})},EmoteModule.prototype.capitalize=function(a){var s=bdEmotes.TwitchGlobal;for(var r in s)if(s.hasOwnProperty(r)&&a==(r+"").toLowerCase())return r};function QuickEmoteMenu(){}QuickEmoteMenu.prototype.init=function(){$(document).on("mousedown",function(d){"rmenu"!=d.target.id&&$("#rmenu").remove()}),this.favoriteEmotes={};var a=window.bdStorage.get("bdfavemotes");""!==a&&null!==a&&(this.favoriteEmotes=JSON.parse(atob(a)));var s="";s+="<div id=\"bda-qem\">",s+="    <button class=\"active\" id=\"bda-qem-twitch\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Twitch</button>",s+="    <button id=\"bda-qem-favourite\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Favourite</button>",s+="    <button id=\"bda-qem-emojis\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Emojis</buttond>",s+="</div>",this.qmeHeader=s;var r="";for(let d in r+="<div id=\"bda-qem-twitch-container\">",r+="    <div class=\"scroller-wrap fade\">",r+="        <div class=\"scroller\">",r+="            <div class=\"emote-menu-inner\">",bdEmotes.TwitchGlobal)if(bdEmotes.TwitchGlobal.hasOwnProperty(d)){var o=bdEmotes.TwitchGlobal[d];r+="<div class=\"emote-container\">",r+="    <img class=\"emote-icon\" alt=\"\" src=\""+o+"\" title=\""+d+"\">",r+="    </img>",r+="</div>"}r+="            </div>",r+="        </div>",r+="    </div>",r+="</div>",this.teContainer=r;var n="";for(let d in n+="<div id=\"bda-qem-favourite-container\">",n+="    <div class=\"scroller-wrap fade\">",n+="        <div class=\"scroller\">",n+="            <div class=\"emote-menu-inner\">",this.favoriteEmotes){var o=this.favoriteEmotes[d];n+="<div class=\"emote-container\">",n+="    <img class=\"emote-icon\" alt=\"\" src=\""+o+"\" title=\""+d+"\" oncontextmenu='quickEmoteMenu.favContext(event, this);'>",n+="    </img>",n+="</div>"}n+="            </div>",n+="        </div>",n+="    </div>",n+="</div>",this.faContainer=n},QuickEmoteMenu.prototype.favContext=function(a,s){a.stopPropagation();var r=$("<div>",{id:"rmenu","data-emoteid":$(s).prop("title"),text:"Remove",class:"context-menu theme-dark"});return r.css({top:a.pageY-$("#bda-qem-favourite-container").offset().top,left:a.pageX-$("#bda-qem-favourite-container").offset().left}),$(s).parent().append(r),r.on("click",function(o){return o.preventDefault(),o.stopPropagation(),$(this).remove(),delete quickEmoteMenu.favoriteEmotes[$(this).data("emoteid")],quickEmoteMenu.updateFavorites(),!1}),!1},QuickEmoteMenu.prototype.switchHandler=function(a){this.switchQem($(a).attr("id"))},QuickEmoteMenu.prototype.switchQem=function(a){var s=$("#bda-qem-twitch"),r=$("#bda-qem-favourite"),o=$("#bda-qem-emojis");s.removeClass("active"),r.removeClass("active"),o.removeClass("active"),$(".emoji-picker, .emojiPicker-3g68GS").hide(),$("#bda-qem-favourite-container").hide(),$("#bda-qem-twitch-container").hide();"bda-qem-twitch"===a?(s.addClass("active"),$("#bda-qem-twitch-container").show()):"bda-qem-favourite"===a?(r.addClass("active"),$("#bda-qem-favourite-container").show()):"bda-qem-emojis"===a?(o.addClass("active"),$(".emoji-picker, .emojiPicker-3g68GS").show(),$(".emoji-picker .search-bar-inner input, .emojiPicker-3g68GS .search-bar-inner input").focus()):void 0;this.lastTab=a;var n=$(".emote-icon");n.off(),n.on("click",function(){var d=$(this).attr("title"),l=utils.getTextArea();utils.insertText(l[0]," "==l.val().slice(-1)?l.val()+d:l.val()+" "+d)})},QuickEmoteMenu.prototype.obsCallback=function(a){var s=$(a);settingsCookie["bda-es-9"]?s.removeClass("bda-qme-hidden"):s.addClass("bda-qme-hidden");settingsCookie["bda-es-0"]&&(s.prepend(this.qmeHeader),s.append(this.teContainer),s.append(this.faContainer),this.lastTab==void 0&&(this.lastTab="bda-qem-favourite"),this.switchQem(this.lastTab))},QuickEmoteMenu.prototype.favorite=function(a,s){this.favoriteEmotes.hasOwnProperty(a)||(this.favoriteEmotes[a]=s),this.updateFavorites()},QuickEmoteMenu.prototype.updateFavorites=function(){var a="";for(var s in a+="<div id=\"bda-qem-favourite-container\">",a+="    <div class=\"scroller-wrap fade\">",a+="        <div class=\"scroller\">",a+="            <div class=\"emote-menu-inner\">",this.favoriteEmotes){var r=this.favoriteEmotes[s];a+="<div class=\"emote-container\">",a+="    <img class=\"emote-icon\" alt=\"\" src=\""+r+"\" title=\""+s+"\" oncontextmenu=\"quickEmoteMenu.favContext(event, this);\">",a+="    </img>",a+="</div>"}a+="            </div>",a+="        </div>",a+="    </div>",a+="</div>",this.faContainer=a,$("#bda-qem-favourite-container").replaceWith(a),window.bdStorage.set("bdfavemotes",btoa(JSON.stringify(this.favoriteEmotes)))};var _hash;function Utils(){}Utils.prototype.getTextArea=function(){return $(".channelTextArea-1HTP3C textarea")},Utils.prototype.insertText=function(a,s){a.focus(),a.selectionStart=0,a.selectionEnd=a.value.length,document.execCommand("insertText",!1,s)},Utils.prototype.jqDefer=function(a){window.jQuery?a():setTimeout(function(){this.jqDefer(a)},100)},Utils.prototype.getHash=function(){$.getJSON("https://api.github.com/repos/Jiiks/BetterDiscordApp/commits/master",function(a){_hash=a.sha,emoteModule.getBlacklist()})},Utils.prototype.loadHtml=function(a,s){var r=$("<div/>",{class:"bd-container"}).appendTo("body");a="//cdn.rawgit.com/Jiiks/BetterDiscordApp/"+_hash+"/html/"+a+".html",r.load(a,s())},Utils.prototype.injectJs=function(a){$("<script/>",{type:"text/javascript",src:a}).appendTo($("body"))},Utils.prototype.injectCss=function(a){$("<link/>",{type:"text/css",rel:"stylesheet",href:a}).appendTo($("head"))},Utils.prototype.escapeID=function(a){return a.replace(/^[^a-z]+|[^\w-]+/gi,"")},Utils.prototype.log=function(a){console.log("%c[BetterDiscord] %c"+a+"","color: #3a71c1; font-weight: 700;","")},Utils.prototype.err=function(a,s){console.log("%c[BetterDiscord] %c"+a+"","color: red; font-weight: 700;",""),s&&(console.groupCollapsed("%cError: "+s.message,"color: red;"),console.error(s.stack),console.groupEnd())};function VoiceMode(){}VoiceMode.prototype.obsCallback=function(){var a=this;settingsCookie["bda-gs-4"]&&(a.disable(),setTimeout(function(){a.enable()},300))},VoiceMode.prototype.enable=function(){$(".scroller.guild-channels ul").first().css("display","none"),$(".scroller.guild-channels header").first().css("display","none"),$(".app.flex-vertical").first().css("overflow","hidden"),$(".chat.flex-vertical.flex-spacer").first().css("visibility","hidden").css("min-width","0px"),$(".flex-vertical.channels-wrap").first().css("flex-grow","100000"),$(".guild-header .btn.btn-hamburger").first().css("visibility","hidden")},VoiceMode.prototype.disable=function(){$(".scroller.guild-channels ul").first().css("display",""),$(".scroller.guild-channels header").first().css("display",""),$(".app.flex-vertical").first().css("overflow",""),$(".chat.flex-vertical.flex-spacer").first().css("visibility","").css("min-width",""),$(".flex-vertical.channels-wrap").first().css("flex-grow",""),$(".guild-header .btn.btn-hamburger").first().css("visibility","")};var pluginCookie={};function PluginModule(){}PluginModule.prototype.loadPlugins=function(){this.loadPluginData();for(var a=Object.keys(bdplugins),s=0;s<a.length;s++){var r,o;try{r=bdplugins[a[s]].plugin,o=r.getName(),r.load()}catch(n){pluginCookie[o]=!1,utils.err("Plugin "+o+" could not be loaded.",n),bdpluginErrors.push({name:o,file:bdplugins[a[s]].filename,reason:"load() could not be fired.",error:{message:n.message,stack:n.stack}});continue}if(pluginCookie[o]||(pluginCookie[o]=!1),pluginCookie[o])try{r.start(),settingsCookie["fork-ps-2"]&&mainCore.showToast(`${r.getName()} v${r.getVersion()} has started.`)}catch(n){pluginCookie[o]=!1,utils.err("Plugin "+o+" could not be started.",n),bdpluginErrors.push({name:o,file:bdplugins[a[s]].filename,reason:"start() could not be fired.",error:{message:n.message,stack:n.stack}})}}this.savePluginData()},PluginModule.prototype.startPlugin=function(a){try{bdplugins[a].plugin.start(),settingsCookie["fork-ps-2"]&&mainCore.showToast(`${bdplugins[a].plugin.getName()} v${bdplugins[a].plugin.getVersion()} has started.`)}catch(s){pluginCookie[a]=!1,this.savePluginData(),utils.err("Plugin "+name+" could not be started.",s)}},PluginModule.prototype.stopPlugin=function(a){try{bdplugins[a].plugin.stop(),settingsCookie["fork-ps-2"]&&mainCore.showToast(`${bdplugins[a].plugin.getName()} v${bdplugins[a].plugin.getVersion()} has stopped.`)}catch(s){utils.err("Plugin "+name+" could not be stopped.",s)}},PluginModule.prototype.enablePlugin=function(a){pluginCookie[a]=!0,this.savePluginData(),this.startPlugin(a)},PluginModule.prototype.disablePlugin=function(a){pluginCookie[a]=!1,this.savePluginData(),this.stopPlugin(a)},PluginModule.prototype.togglePlugin=function(a){pluginCookie[a]?this.disablePlugin(a):this.enablePlugin(a)},PluginModule.prototype.loadPluginData=function(){var a=$.cookie("bd-plugins");a!=void 0&&(pluginCookie=JSON.parse($.cookie("bd-plugins")))},PluginModule.prototype.savePluginData=function(){$.cookie("bd-plugins",JSON.stringify(pluginCookie),{expires:365,path:"/"})},PluginModule.prototype.newMessage=function(){for(var r,a=Object.keys(bdplugins),s=0;s<a.length;s++)if(r=bdplugins[a[s]].plugin,pluginCookie[r.getName()]&&"function"==typeof r.onMessage)try{r.onMessage()}catch(B){utils.err("Unable to fire onMessage for "+r.getName()+".",B)}},PluginModule.prototype.channelSwitch=function(){for(var r,a=Object.keys(bdplugins),s=0;s<a.length;s++)if(r=bdplugins[a[s]].plugin,pluginCookie[r.getName()]&&"function"==typeof r.onSwitch)try{r.onSwitch()}catch(O){utils.err("Unable to fire onSwitch for "+r.getName()+".",O)}},PluginModule.prototype.rawObserver=function(a){for(var o,s=Object.keys(bdplugins),r=0;r<s.length;r++)if(o=bdplugins[s[r]].plugin,pluginCookie[o.getName()]&&"function"==typeof o.observer)try{o.observer(a)}catch(q){utils.err("Unable to fire observer for "+o.getName()+".",q)}};var themeCookie={};function ThemeModule(){}ThemeModule.prototype.loadThemes=function(){this.loadThemeData();for(var r,a=Object.keys(bdthemes),s=0;s<a.length;s++)r=bdthemes[a[s]].name,themeCookie[r]||(themeCookie[r]=!1),themeCookie[r]&&$("head").append($("<style>",{id:utils.escapeID(r),html:unescape(bdthemes[r].css)}))},ThemeModule.prototype.enableTheme=function(a){themeCookie[a]=!0,this.saveThemeData(),$("head").append(`<style id="${utils.escapeID(bdthemes[a].name)}">${unescape(bdthemes[a].css)}</style>`),settingsCookie["fork-ps-2"]&&mainCore.showToast(`${bdthemes[a].name} v${bdthemes[a].version} has been applied.`)},ThemeModule.prototype.disableTheme=function(a){themeCookie[a]=!1,this.saveThemeData(),$(`#${utils.escapeID(bdthemes[a].name)}`).remove(),settingsCookie["fork-ps-2"]&&mainCore.showToast(`${bdthemes[a].name} v${bdthemes[a].version} has been removed.`)},ThemeModule.prototype.toggleTheme=function(a){themeCookie[a]?this.disableTheme(a):this.enableTheme(a)},ThemeModule.prototype.loadThemeData=function(){var a=$.cookie("bd-themes");a!=void 0&&(themeCookie=JSON.parse($.cookie("bd-themes")))},ThemeModule.prototype.saveThemeData=function(){$.cookie("bd-themes",JSON.stringify(themeCookie),{expires:365,path:"/"})};function BdApi(){}BdApi.injectCSS=function(a,s){$("head").append($("<style>",{id:utils.escapeID(a),html:s}))},BdApi.clearCSS=function(a){$("#"+utils.escapeID(a)).remove()},BdApi.linkJS=function(a,s){$("head").append($("<script>",{id:utils.escapeID(a),src:s,type:"text/javascript"}))},BdApi.unlinkJS=function(a){$("#"+utils.escapeID(a)).remove()},BdApi.getPlugin=function(a){return bdplugins.hasOwnProperty(a)?bdplugins[a].plugin:null},BdApi.getIpc=function(){return betterDiscordIPC},BdApi.getCore=function(){return mainCore},BdApi.alert=function(a,s){mainCore.alert(a,s)},BdApi.showToast=function(a,s={}){mainCore.showToast(a,s)};function devMode(){}devMode.prototype.enable=function(a){var s=this;this.disable(),$(window).on("keydown.bdDevmode",function(r){if(119===r.which){console.log("%c[%cDevMode%c] %cBreak/Resume","color: red;","color: #303030; font-weight:700;","color:red;","");debugger}});a&&$(document).on("contextmenu.bdDevmode",function(r){var n=[];$(r.toElement).parents().addBack().not("html").each(function(){var d="";this.classList&&this.classList.length&&(d+="."+Array.prototype.join.call(this.classList,"."),n.push(d))}),s.lastSelector=n.join(" ").trim(),setImmediate(function(){var d=$(".context-menu");0>=d.length&&(d=$("<div class=\"context-menu bd-context-menu\"></div>"),d.addClass($(".app").hasClass("theme-dark")?"theme-dark":"theme-light"),d.appendTo(".app"),d.css("top",r.clientY),d.css("left",r.clientX),$(document).on("click.bdDevModeCtx",()=>{d.remove(),$(document).off(".bdDevModeCtx")}),$(document).on("contextmenu.bdDevModeCtx",()=>{d.remove(),$(document).off(".bdDevModeCtx")}),$(document).on("keyup.bdDevModeCtx",h=>{27===h.keyCode&&(d.remove(),$(document).off(".bdDevModeCtx"))}));var l=$("<div/>",{class:"item-group"}),u=$("<div/>",{class:"item",click:function(){var h=$("<textarea/>",{text:s.lastSelector}).appendTo("body");h.select(),document.execCommand("copy"),h.remove(),d.hide()}}).append($("<span/>",{text:"Copy Selector"}));l.append(u),d.append(l),d.css("top","-="+l.outerHeight())}),r.stopPropagation()})},devMode.prototype.disable=function(){$(window).off("keydown.bdDevmode"),$(document).off("contextmenu.bdDevmode"),$(document).off("contextmenu.bdDevModeCtx")},window.bdtemp={editorDetached:!1};class V2{constructor(){this.WebpackModules=(()=>{const a=webpackJsonp([],{__extra_id__:(n,d,l)=>d.default=l},["__extra_id__"]).default;delete a.m.__extra_id__,delete a.c.__extra_id__;const s=(n,d={})=>{const{cacheOnly:l=!0}=d;for(let u in a.c)if(a.c.hasOwnProperty(u)){let h=a.c[u].exports;if(h&&h.__esModule&&h.default&&n(h.default))return h.default;if(h&&n(h))return h}if(l)return console.warn("Cannot find loaded module in cache"),null;console.warn("Cannot find loaded module in cache. Loading all modules may have unexpected side effects");for(let u=0;u<a.m.length;++u)try{let h=a(u);if(h&&h.__esModule&&h.default&&n(h.default))return h.default;if(h&&n(h))return h}catch(h){console.error(h)}return console.warn("Cannot find module"),null};return{find:s,findByUniqueProperties:(n,d)=>s(l=>n.every(u=>l[u]!==void 0),d),findByDisplayName:(n,d)=>s(l=>l.displayName===n,d)}})(),this.internal={react:this.WebpackModules.findByUniqueProperties(["Component","PureComponent","Children","createElement","cloneElement"]),"react-dom":this.WebpackModules.findByUniqueProperties(["findDOMNode"])}}get reactComponent(){return this.internal.react.Component}get react(){return this.internal.react}get reactDom(){return this.internal["react-dom"]}parseSettings(a){return Object.keys(settings).reduce((s,r)=>{let o=settings[r];return o.cat===a&&o.implemented&&!o.hidden&&(o.text=r,s.push(o)),s},[])}}window.BDV2=new V2;class V2C_SettingsPanel extends BDV2.reactComponent{constructor(a){super(a)}render(){let{settings:a}=this.props;return BDV2.react.createElement("div",{className:"content-column default"},BDV2.react.createElement(V2Components.SettingsTitle,{text:this.props.title}),this.props.button&&BDV2.react.createElement("button",{key:"title-button",className:"bd-pfbtn",onClick:this.props.button.onClick},this.props.button.title),a.map(s=>{return BDV2.react.createElement(V2Components.Switch,{id:s.id,key:s.id,data:s,checked:settingsCookie[s.id],onChange:(r,o)=>{this.props.onChange(r,o)}})}))}}class V2C_Switch extends BDV2.reactComponent{constructor(a){super(a),this.setInitialState(),this.onChange=this.onChange.bind(this)}setInitialState(){this.state={checked:this.props.checked}}render(){let{text:a,info:s}=this.props.data,{checked:r}=this.state;return BDV2.react.createElement("div",{className:"ui-flex flex-vertical flex-justify-start flex-align-stretch flex-nowrap ui-switch-item"},BDV2.react.createElement("div",{className:"ui-flex flex-horizontal flex-justify-start flex-align-stretch flex-nowrap"},BDV2.react.createElement("h3",{className:"ui-form-title h3 margin-reset margin-reset ui-flex-child"},a),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{className:"ui-switch-checkbox",type:"checkbox",checked:r,onChange:o=>this.onChange(o)}),BDV2.react.createElement("div",{className:`ui-switch ${r?"checked":""}`}))),BDV2.react.createElement("div",{className:"ui-form-text style-description margin-top-4",style:{flex:"1 1 auto"}},s))}onChange(){this.props.onChange(this.props.id,!this.state.checked),this.setState({checked:!this.state.checked})}}class V2C_Scroller extends BDV2.reactComponent{constructor(a){super(a)}render(){let a=`scroller-wrap${this.props.fade?" fade":""} ${this.props.dark?" dark":""}`,{children:s}=this.props;return BDV2.react.createElement("div",{key:"scrollerwrap",className:a},BDV2.react.createElement("div",{key:"scroller",ref:"scroller",className:"scroller"},s))}}class V2C_TabBarItem extends BDV2.reactComponent{constructor(a){super(a),this.setInitialState(),this.onClick=this.onClick.bind(this)}setInitialState(){this.state={selected:this.props.selected||!1}}render(){return BDV2.react.createElement("div",{className:`ui-tab-bar-item${this.props.selected?" selected":""}`,onClick:this.onClick},this.props.text)}onClick(){this.props.onClick&&this.props.onClick(this.props.id)}}class V2C_TabBarSeparator extends BDV2.reactComponent{constructor(a){super(a)}render(){return BDV2.react.createElement("div",{className:"ui-tab-bar-separator margin-top-8 margin-bottom-8"})}}class V2C_TabBarHeader extends BDV2.reactComponent{constructor(a){super(a)}render(){return BDV2.react.createElement("div",{className:"ui-tab-bar-header"},this.props.text)}}class V2C_SideBar extends BDV2.reactComponent{constructor(a){super(a);let s=this;const r=$("[class*=side] > [class*=selected]");r.length&&(s.scn=r.attr("class"));const o=$("[class*=side] > [class*=notSelected]");o.length&&(s.nscn=o.attr("class")),$("[class*=side] > [class*=item]").on("click",()=>{s.setState({selected:null})}),s.setInitialState(),s.onClick=s.onClick.bind(s)}setInitialState(){let a=this;a.state={selected:null,items:a.props.items};let s=a.props.items.find(r=>{return r.selected});s&&(a.state.selected=s.id)}render(){let a=this,{headerText:s}=a.props,{items:r,selected:o}=a.state;return BDV2.react.createElement("div",null,BDV2.react.createElement(V2Components.TabBar.Separator,null),BDV2.react.createElement(V2Components.TabBar.Header,{text:s}),r.map(n=>{let{id:d,text:l}=n;return BDV2.react.createElement(V2Components.TabBar.Item,{key:d,selected:o===d,text:l,id:d,onClick:a.onClick})}))}onClick(a){let s=this;const r=$("[class*=side] > [class*=selected]");r.length&&(r.off("click.bdsb").on("click.bsb",o=>{$(o.target).attr("class",s.scn)}),r.attr("class",s.nscn)),s.setState({selected:null}),s.setState({selected:a}),s.props.onClick&&s.props.onClick(a)}}class V2C_XSvg extends BDV2.reactComponent{constructor(a){super(a)}render(){return BDV2.react.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",style:{width:"18px",height:"18px"}},BDV2.react.createElement("g",{className:"background",fill:"none",fillRule:"evenodd"},BDV2.react.createElement("path",{d:"M0 0h12v12H0"}),BDV2.react.createElement("path",{className:"fill",fill:"#dcddde",d:"M9.5 3.205L8.795 2.5 6 5.295 3.205 2.5l-.705.705L5.295 6 2.5 8.795l.705.705L6 6.705 8.795 9.5l.705-.705L6.705 6"})))}}class V2C_Tools extends BDV2.reactComponent{constructor(a){super(a),this.onClick=this.onClick.bind(this)}render(){return BDV2.react.createElement("div",{className:"tools"},BDV2.react.createElement("div",{className:"btn-close",onClick:this.onClick},BDV2.react.createElement(V2Components.XSvg,null)),BDV2.react.createElement("div",{className:"esc-text"},"ESC"))}onClick(){this.props.onClick&&this.props.onClick(),$(".btn-close").first().click()}}class V2C_SettingsTitle extends BDV2.reactComponent{constructor(a){super(a)}render(){return BDV2.react.createElement("h2",{className:"ui-form-title h2 margin-reset margin-bottom-20"},this.props.text)}}class V2C_Checkbox extends BDV2.reactComponent{constructor(a){super(a),this.onClick=this.onClick.bind(this),this.setInitialState()}setInitialState(){this.state={checked:this.props.checked||!1}}render(){return BDV2.react.createElement("li",null,BDV2.react.createElement("div",{className:"checkbox",onClick:this.onClick},BDV2.react.createElement("div",{className:"checkbox-inner"},BDV2.react.createElement("input",{checked:this.state.checked,onChange:()=>{},type:"checkbox"}),BDV2.react.createElement("span",null)),BDV2.react.createElement("span",null,this.props.text)))}onClick(){this.props.onChange(this.props.id,!this.state.checked),this.setState({checked:!this.state.checked})}}class V2C_CssEditorDetached extends BDV2.reactComponent{constructor(a){super(a);let s=this;s.onClick=s.onClick.bind(s),s.updateCss=s.updateCss.bind(s),s.saveCss=s.saveCss.bind(s),s.onChange=s.onChange.bind(s)}componentDidMount(){$("#app-mount").addClass("bd-detached-editor"),window.bdtemp.editorDetached=!0,this.editor=ace.edit("bd-customcss-editor-detached"),this.editor.setTheme("ace/theme/monokai"),this.editor.session.setMode("ace/mode/css"),this.editor.setShowPrintMargin(!1),this.editor.setFontSize(14),this.editor.on("change",()=>{settingsCookie["bda-css-0"]&&(this.saveCss(),this.updateCss())})}componentWillUnmount(){$("#app-mount").removeClass("bd-detached-editor"),window.bdtemp.editorDetached=!1,this.editor.destroy()}updateLineCount(){let a=this.refs.editor.value.split("\n").length;a==this.props.lines||(this.refs.lines.textContent=Array.from(Array(a),(s,r)=>r+1).join(".\n")+".",this.props.lines=a)}get options(){return{lineNumbers:!0,mode:"css",indentUnit:4,theme:"material",scrollbarStyle:"simple"}}get css(){let a=window.bdStorage.get("bdcustomcss"),s="";return a&&""!==a&&(s=atob(a)),s}get root(){let a=$("#bd-customcss-detach-container");return a.length?a[0]:this.injectRoot()?this.detachedRoot:null}injectRoot(){return!!$(".app").length&&($("<div/>",{id:"bd-customcss-detach-container"}).insertAfter($(".app")),!0)}render(){let a=this;return BDV2.react.createElement("div",{className:"bd-detached-css-editor",id:"bd-customcss-detach-editor"},BDV2.react.createElement("div",{id:"bd-customcss-innerpane"},BDV2.react.createElement("div",{className:"editor-wrapper"},BDV2.react.createElement("div",{id:"bd-customcss-editor-detached",className:"editor",ref:"editor"},a.css)),BDV2.react.createElement("div",{id:"bd-customcss-attach-controls"},BDV2.react.createElement("ul",{className:"checkbox-group"},BDV2.react.createElement(V2Components.Checkbox,{id:"live-update",text:"Live Update",onChange:a.onChange,checked:settingsCookie["bda-css-0"]})),BDV2.react.createElement("div",{id:"bd-customcss-detach-controls-button"},BDV2.react.createElement("button",{style:{borderRadius:"3px 0 0 3px",borderRight:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{a.onClick("update")}},"Update"),BDV2.react.createElement("button",{style:{borderRadius:"0",borderLeft:"1px solid #2d2d2d",borderRight:"1px solid #2d2d2d"},className:"btn btn-primary",onClick:()=>{a.onClick("save")}},"Save"),BDV2.react.createElement("button",{style:{borderRadius:"0 3px 3px 0",borderLeft:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{a.onClick("attach")}},"Attach"),BDV2.react.createElement("span",{style:{fontSize:"10px",marginLeft:"5px"}},"Unsaved changes are lost on attach")))))}onChange(a,s){"live-update"===a?(settingsCookie["bda-css-0"]=s,mainCore.saveSettings()):void 0}onClick(a){let s=this;"attach"===a?($("#editor-detached").length&&s.props.attach(),BDV2.reactDom.unmountComponentAtNode(s.root),s.root.remove()):"update"===a?s.updateCss():"save"===a?s.saveCss():void 0}updateCss(){0==$("#customcss").length&&$("head").append("<style id=\"customcss\"></style>"),$("#customcss").html(this.editor.session.getValue()).detach().appendTo(document.head)}saveCss(){window.bdStorage.set("bdcustomcss",btoa(this.editor.session.getValue()))}}class V2C_CssEditor extends BDV2.reactComponent{constructor(a){super(a);let s=this;s.props.lines=0,s.setInitialState(),s.attach=s.attach.bind(s),s.detachedEditor=BDV2.react.createElement(V2C_CssEditorDetached,{attach:s.attach}),s.onClick=s.onClick.bind(s),s.updateCss=s.updateCss.bind(s),s.saveCss=s.saveCss.bind(s),s.detach=s.detach.bind(s)}setInitialState(){this.state={detached:this.props.detached||window.bdtemp.editorDetached}}componentDidMount(){this.editor=ace.edit("bd-customcss-editor"),this.editor.setTheme("ace/theme/monokai"),this.editor.session.setMode("ace/mode/css"),this.editor.setShowPrintMargin(!1),this.editor.setFontSize(14),this.editor.on("change",()=>{settingsCookie["bda-css-0"]&&(this.saveCss(),this.updateCss())})}componentWillUnmount(){this.editor.destroy()}componentDidUpdate(a,s){let r=this;s.detached&&!r.state.detached&&BDV2.reactDom.unmountComponentAtNode(r.detachedRoot)}codeMirror(){}get options(){return{lineNumbers:!0,mode:"css",indentUnit:4,theme:"material",scrollbarStyle:"simple"}}get css(){let a=window.bdStorage.get("bdcustomcss"),s="";return a&&""!==a&&(s=atob(a)),s}updateLineCount(){let a=this.refs.editor.value.split("\n").length;a==this.props.lines||(this.refs.lines.textContent=Array.from(Array(a),(s,r)=>r+1).join(".\n")+".",this.props.lines=a)}render(){let a=this,{detached:s}=a.state;return BDV2.react.createElement("div",{className:"content-column default",style:{padding:"60px 40px 0px"}},s&&BDV2.react.createElement("div",{id:"editor-detached"},BDV2.react.createElement(V2Components.SettingsTitle,{text:"Custom CSS Editor"}),BDV2.react.createElement("h3",null,"Editor Detached"),BDV2.react.createElement("button",{className:"btn btn-primary",onClick:()=>{a.attach()}},"Attach")),!s&&BDV2.react.createElement("div",null,BDV2.react.createElement(V2Components.SettingsTitle,{text:"Custom CSS Editor"}),BDV2.react.createElement("div",{className:"editor-wrapper"},BDV2.react.createElement("div",{id:"bd-customcss-editor",className:"editor",ref:"editor"},a.css)),BDV2.react.createElement("div",{id:"bd-customcss-attach-controls"},BDV2.react.createElement("ul",{className:"checkbox-group"},BDV2.react.createElement(V2Components.Checkbox,{id:"live-update",text:"Live Update",onChange:this.onChange,checked:settingsCookie["bda-css-0"]})),BDV2.react.createElement("div",{id:"bd-customcss-detach-controls-button"},BDV2.react.createElement("button",{style:{borderRadius:"3px 0 0 3px",borderRight:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{a.onClick("update")}},"Update"),BDV2.react.createElement("button",{style:{borderRadius:"0",borderLeft:"1px solid #2d2d2d",borderRight:"1px solid #2d2d2d"},className:"btn btn-primary",onClick:()=>{a.onClick("save")}},"Save"),BDV2.react.createElement("button",{style:{borderRadius:"0 3px 3px 0",borderLeft:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{a.onClick("detach")}},"Detach"),BDV2.react.createElement("span",{style:{fontSize:"10px",marginLeft:"5px"}},"Unsaved changes are lost on detach")))))}onClick(a){let s=this;"update"===a?s.updateCss():"save"===a?s.saveCss():"detach"===a?s.detach():void 0}onChange(a,s){"live-update"===a?(settingsCookie["bda-css-0"]=s,mainCore.saveSettings()):void 0}updateCss(){0==$("#customcss").length&&$("head").append("<style id=\"customcss\"></style>"),$("#customcss").html(this.editor.session.getValue()).detach().appendTo(document.head)}saveCss(){window.bdStorage.set("bdcustomcss",btoa(this.editor.session.getValue()))}detach(){let a=this;a.setState({detached:!0});let s=a.detachedRoot;return s?void BDV2.reactDom.render(a.detachedEditor,s):void console.log("FAILED TO INJECT ROOT: .app")}get detachedRoot(){let a=$("#bd-customcss-detach-container");return a.length?a[0]:this.injectDetachedRoot()?this.detachedRoot:null}injectDetachedRoot(){return!!$(".app").length&&($("<div/>",{id:"bd-customcss-detach-container"}).insertAfter($(".app")),!0)}attach(){let a=this;a.setState({detached:!1})}}class V2C_List extends BDV2.reactComponent{constructor(a){super(a)}render(){return BDV2.react.createElement("ul",{className:this.props.className},this.props.children)}}class V2C_ContentColumn extends BDV2.reactComponent{constructor(a){super(a)}render(){return BDV2.react.createElement("div",{className:"content-column default"},BDV2.react.createElement("h2",{className:"ui-form-title h2 margin-reset margin-bottom-20"},this.props.title),this.props.children)}}class V2C_PluginCard extends BDV2.reactComponent{constructor(a){super(a);let s=this;s.onChange=s.onChange.bind(s),s.showSettings=s.showSettings.bind(s),s.setInitialState(),s.hasSettings="function"==typeof s.props.plugin.getSettingsPanel,s.settingsPanel=""}setInitialState(){this.state={checked:pluginCookie[this.props.plugin.getName()],settings:!1}}componentDidUpdate(){if(this.state.settings){if("object"==typeof this.settingsPanel&&this.refs.settingspanel.appendChild(this.settingsPanel),!settingsCookie["fork-ps-3"])return;var a=(o,n)=>{let d=o.scrollTop,l=d+o.clientHeight,u=n.offsetTop,h=u+n.clientHeight;return u<d||h>l};let s=$(BDV2.reactDom.findDOMNode(this)),r=s.parents(".scroller");if(!a(r[0],s[0]))return;r.animate({scrollTop:s.offset().top-r.offset().top+r.scrollTop()-30},300)}}render(){let a=this,{plugin:s}=this.props,r=s.getName(),o=s.getAuthor(),n=s.getDescription(),d=s.getVersion(),l=bdplugins[r].website,u=bdplugins[r].source;if(this.state.settings){try{a.settingsPanel=s.getSettingsPanel()}catch(h){utils.err("Unable to get settings panel for "+s.getName()+".",h)}return BDV2.react.createElement("li",{className:"settings-open ui-switch-item"},BDV2.react.createElement("div",{style:{float:"right",cursor:"pointer"},onClick:()=>{this.refs.settingspanel.innerHTML="",a.setState({settings:!1})}},BDV2.react.createElement(V2Components.XSvg,null)),"object"==typeof a.settingsPanel&&BDV2.react.createElement("div",{id:`plugin-settings-${r}`,className:"plugin-settings",ref:"settingspanel"}),"object"!=typeof a.settingsPanel&&BDV2.react.createElement("div",{id:`plugin-settings-${r}`,className:"plugin-settings",ref:"settingspanel",dangerouslySetInnerHTML:{__html:a.settingsPanel}}))}return BDV2.react.createElement("li",{"data-name":r,"data-version":d,className:"settings-closed ui-switch-item"},BDV2.react.createElement("div",{className:"bda-header"},BDV2.react.createElement("span",{className:"bda-header-title"},BDV2.react.createElement("span",{className:"bda-name"},r)," v",BDV2.react.createElement("span",{className:"bda-version"},d)," by ",BDV2.react.createElement("span",{className:"bda-author"},o)),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{checked:this.state.checked,onChange:this.onChange,className:"ui-switch-checkbox",type:"checkbox"}),BDV2.react.createElement("div",{className:this.state.checked?"ui-switch checked":"ui-switch"}))),BDV2.react.createElement("div",{className:"bda-description-wrap scroller-wrap fade"},BDV2.react.createElement("div",{className:"bda-description scroller"},n)),(l||u||this.hasSettings)&&BDV2.react.createElement("div",{className:"bda-footer"},BDV2.react.createElement("span",{className:"bda-links"},l&&BDV2.react.createElement("a",{className:"bda-link",href:l,target:"_blank"},"Website"),l&&u&&" | ",u&&BDV2.react.createElement("a",{className:"bda-link",href:u,target:"_blank"},"Source")),this.hasSettings&&BDV2.react.createElement("button",{onClick:this.showSettings,className:"bda-settings-button",disabled:!this.state.checked},"Settings")))}onChange(){this.setState({checked:!this.state.checked}),pluginModule.togglePlugin(this.props.plugin.getName())}showSettings(){this.hasSettings&&this.setState({settings:!0})}}class V2C_ThemeCard extends BDV2.reactComponent{constructor(a){super(a),this.setInitialState(),this.onChange=this.onChange.bind(this)}setInitialState(){this.state={checked:themeCookie[this.props.theme.name]}}render(){let{theme:a}=this.props,s=a.name,r=a.description,o=a.version,n=a.author,d=bdthemes[s].website,l=bdthemes[s].source;return BDV2.react.createElement("li",{"data-name":s,"data-version":o,className:"settings-closed ui-switch-item"},BDV2.react.createElement("div",{className:"bda-header"},BDV2.react.createElement("span",{className:"bda-header-title"},BDV2.react.createElement("span",{className:"bda-name"},s)," v",BDV2.react.createElement("span",{className:"bda-version"},o)," by ",BDV2.react.createElement("span",{className:"bda-author"},n)),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{checked:this.state.checked,onChange:this.onChange,className:"ui-switch-checkbox",type:"checkbox"}),BDV2.react.createElement("div",{className:this.state.checked?"ui-switch checked":"ui-switch"}))),BDV2.react.createElement("div",{className:"bda-description-wrap scroller-wrap fade"},BDV2.react.createElement("div",{className:"bda-description scroller"},r)),(d||l)&&BDV2.react.createElement("div",{className:"bda-footer"},BDV2.react.createElement("span",{className:"bda-links"},d&&BDV2.react.createElement("a",{className:"bda-link",href:d,target:"_blank"},"Website"),d&&l&&" | ",l&&BDV2.react.createElement("a",{className:"bda-link",href:l,target:"_blank"},"Source"))))}onChange(){this.setState({checked:!this.state.checked}),themeModule.toggleTheme(this.props.theme.name)}}class V2Cs_TabBar{static get Item(){return V2C_TabBarItem}static get Header(){return V2C_TabBarHeader}static get Separator(){return V2C_TabBarSeparator}}class V2Components{static get SettingsPanel(){return V2C_SettingsPanel}static get Switch(){return V2C_Switch}static get Scroller(){return V2C_Scroller}static get TabBar(){return V2Cs_TabBar}static get SideBar(){return V2C_SideBar}static get Tools(){return V2C_Tools}static get SettingsTitle(){return V2C_SettingsTitle}static get CssEditor(){return V2C_CssEditor}static get Checkbox(){return V2C_Checkbox}static get List(){return V2C_List}static get PluginCard(){return V2C_PluginCard}static get ThemeCard(){return V2C_ThemeCard}static get ContentColumn(){return V2C_ContentColumn}static get XSvg(){return V2C_XSvg}static get Layer(){return V2C_Layer}static get SidebarView(){return V2C_SidebarView}static get ServerCard(){return V2C_ServerCard}}class V2_SettingsPanel_Sidebar{constructor(a){this.onClick=a}get items(){return[{text:"Core",id:"core"},{text:"Zere's Fork",id:"fork"},{text:"Emotes",id:"emotes"},{text:"Custom CSS",id:"customcss"},{text:"Plugins",id:"plugins"},{text:"Themes",id:"themes"}]}get component(){return BDV2.react.createElement("span",null,BDV2.react.createElement(V2Components.SideBar,{onClick:this.onClick,headerText:"Bandaged BD",items:this.items}),BDV2.react.createElement("div",{style:{fontSize:"12px",fontWeight:"600",color:"#72767d",padding:"2px 10px"}},`BD v${bdVersion}, JS v${jsVersion} by `,BDV2.react.createElement("a",{href:"https://github.com/Jiiks/",target:"_blank"},"Jiiks")),BDV2.react.createElement("div",{style:{fontSize:"12px",fontWeight:"600",color:"#72767d",padding:"2px 10px"}},`BBD v${bbdVersion} by `,BDV2.react.createElement("a",{href:"https://github.com/rauenzi/",target:"_blank"},"Zerebos")))}get root(){let a=$("#bd-settings-sidebar");return a.length?a[0]:this.injectRoot()?this.root:null}injectRoot(){let a=$("[class*=side] > [class*=item]:not([class*=Danger])").last();return!!a.length&&($("<span/>",{id:"bd-settings-sidebar"}).insertBefore(a.prev()),!0)}render(){let a=this.root;return a?void BDV2.reactDom.render(this.component,a):void console.log("FAILED TO LOCATE ROOT: [class*=side] > [class*=item]:not([class*=Danger])")}}class V2_SettingsPanel{constructor(){let a=this;a.sideBarOnClick=a.sideBarOnClick.bind(a),a.onChange=a.onChange.bind(a),a.updateSettings=this.updateSettings.bind(a),a.sidebar=new V2_SettingsPanel_Sidebar(a.sideBarOnClick)}get root(){let a=$("#bd-settingspane-container");return a.length?a[0]:this.injectRoot()?this.root:null}injectRoot(){return!!$(".layer .ui-standard-sidebar-view, .layer-kosS71 .ui-standard-sidebar-view").length&&($(".layer .ui-standard-sidebar-view, .layer-kosS71 .ui-standard-sidebar-view").append($("<div/>",{class:"content-region",id:"bd-settingspane-container"})),!0)}get coreSettings(){return this.getSettings("core")}get forkSettings(){return this.getSettings("fork")}get emoteSettings(){return this.getSettings("emote")}getSettings(a){return Object.keys(settings).reduce((s,r)=>{let o=settings[r];return o.cat===a&&o.implemented&&!o.hidden&&(o.text=r,s.push(o)),s},[])}sideBarOnClick(a){let s=this;$(".content-region").first().hide(),$(s.root).show();"core"===a?s.renderCoreSettings():"fork"===a?s.renderForkSettings():"emotes"===a?s.renderEmoteSettings():"customcss"===a?s.renderCustomCssEditor():"plugins"===a?s.renderPluginPane():"themes"===a?s.renderThemePane():void 0}onClick(){}onChange(a,s){settingsCookie[a]=s,this.updateSettings()}updateSettings(){let a=settingsCookie;if(a["bda-es-0"]?$("#twitchcord-button-container").show():$("#twitchcord-button-container").hide(),a["bda-gs-b"]?$("body").addClass("bd-blue"):$("body").removeClass("bd-blue"),a["bda-gs-2"]?$("body").addClass("bd-minimal"):$("body").removeClass("bd-minimal"),a["bda-gs-3"]?$("body").addClass("bd-minimal-chan"):$("body").removeClass("bd-minimal-chan"),a["bda-gs-1"]?$("#bd-pub-li").show():$("#bd-pub-li").hide(),a["bda-gs-4"]?voiceMode.enable():voiceMode.disable(),a["bda-gs-5"]?$("#app-mount").addClass("bda-dark"):$("#app-mount").removeClass("bda-dark"),document.querySelector(".messages")){let r=document.querySelector(".messages");a["bda-gs-6"]?mainCore.inject24Hour(r):mainCore.remove24Hour(r),a["bda-gs-7"]&&document.querySelector(".messages")?mainCore.injectColoredText(r):mainCore.removeColoredText(r)}a["fork-es-2"]?$(".emote").each(()=>{$(this).addClass("stop-animation")}):$(".emote").each(()=>{$(this).removeClass("stop-animation")}),$(document).off("mouseover",".emote");var s=$("<div class='tipsy tipsy-se' style='display: block; top: 82px; left: 1630.5px; visibility: visible; opacity: 0.8;'><div class='tipsy-inner'></div></div>");$(document).on("mouseover",".emote",function(){var r=$(this);if(a["fork-es-2"]&&a["bda-es-8"]&&r.removeClass("stop-animation"),!!a["bda-es-6"]){var o=r.offset(),n=r.attr("alt"),d=r.attr("data-modifier");d&&a["fork-es-1"]&&(n=n+":"+d),s.find(".tipsy-inner").text(n),$(".app").append($(s));var l=o.left+r.outerWidth()/2;s.css("left",l-s.outerWidth()/2),s.css("top",o.top-s.outerHeight())}}),$(document).on("mouseleave",".emote",function(){a["bda-es-6"]&&$(".tipsy").remove(),a["fork-es-2"]&&a["bda-es-8"]&&$(this).addClass("stop-animation")}),a["bda-gs-8"]?dMode.enable(a["fork-dm-1"]):dMode.disable(),mainCore.saveSettings()}renderSidebar(){let a=this;$("[class*=side] > [class*=item]").off("click.v2settingspanel").on("click.v2settingspanel",()=>{BDV2.reactDom.unmountComponentAtNode(a.root),$(a.root).hide(),$(".content-region").first().show()}),a.sidebar.render()}get coreComponent(){return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"cspanel",title:"Core Settings",onChange:this.onChange,settings:this.coreSettings}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get forkComponent(){return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"fspanel",title:"Zere's Fork Settings",onChange:this.onChange,settings:this.forkSettings,button:{title:"Clear Emote Cache",onClick:()=>{emoteModule.clearEmoteData(),emoteModule.init(),quickEmoteMenu.init()}}}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get emoteComponent(){return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"espanel",title:"Emote Settings",onChange:this.onChange,settings:this.emoteSettings}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get customCssComponent(){return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.CssEditor,{key:"csseditor"}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get pluginsComponent(){let a=Object.keys(bdplugins).reduce((n,d)=>{return n.push(BDV2.react.createElement(V2Components.PluginCard,{key:d,plugin:bdplugins[d].plugin})),n},[]),s=BDV2.react.createElement(V2Components.List,{key:"plugin-list",className:"bda-slist",children:a}),r=BDV2.react.createElement("button",{key:"folder-button",className:"bd-pfbtn",onClick:()=>{betterDiscordIPC.send("asynchronous-message",{arg:"opendir",path:"plugindir"})}},"Open Plugin Folder"),o=BDV2.react.createElement(V2Components.ContentColumn,{key:"pcolumn",title:"Plugins",children:[r,s]});return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[o,BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get themesComponent(){let a=Object.keys(bdthemes).reduce((n,d)=>{return n.push(BDV2.react.createElement(V2Components.ThemeCard,{key:d,theme:bdthemes[d]})),n},[]),s=BDV2.react.createElement(V2Components.List,{key:"theme-list",className:"bda-slist",children:a}),r=BDV2.react.createElement("button",{key:"folder-button",className:"bd-pfbtn",onClick:()=>{betterDiscordIPC.send("asynchronous-message",{arg:"opendir",path:"themedir"})}},"Open Theme Folder"),o=BDV2.react.createElement(V2Components.ContentColumn,{key:"tcolumn",title:"Themes",children:[r,s]});return BDV2.react.createElement(V2Components.Scroller,{fade:!0,dark:!0,children:[o,BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}renderCoreSettings(){let a=this.root;return a?void BDV2.reactDom.render(this.coreComponent,a):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderForkSettings(){let a=this.root;return a?void BDV2.reactDom.render(this.forkComponent,a):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderEmoteSettings(){let a=this.root;return a?void BDV2.reactDom.render(this.emoteComponent,a):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderCustomCssEditor(){let a=this.root;return a?void BDV2.reactDom.render(this.customCssComponent,a):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderPluginPane(){let a=this.root;return a?void BDV2.reactDom.render(this.pluginsComponent,a):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderThemePane(){let a=this.root;return a?void BDV2.reactDom.render(this.themesComponent,a):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}}class V2C_Layer extends BDV2.reactComponent{constructor(a){super(a)}componentDidMount(){$(window).on(`keyup.${this.props.id}`,a=>{27===a.which&&BDV2.reactDom.unmountComponentAtNode(this.refs.root.parentNode)})}componentWillUnmount(){$(window).off(`keyup.${this.props.id}`),$(`#${this.props.rootId}`).remove()}render(){return BDV2.react.createElement("div",{className:"layer bd-layer layer-kosS71",id:this.props.id,ref:"root"},this.props.children)}}class V2C_SidebarView extends BDV2.reactComponent{constructor(a){super(a)}render(){let{sidebar:a,content:s,tools:r}=this.props.children;return BDV2.react.createElement("div",{className:"ui-standard-sidebar-view"},BDV2.react.createElement("div",{className:"sidebar-region"},BDV2.react.createElement(V2Components.Scroller,{key:"sidebarScroller",ref:"sidebarScroller",fade:a.fade||!0,dark:a.dark||!0,children:a.component})),BDV2.react.createElement("div",{className:"content-region"},BDV2.react.createElement("div",{className:"content-transition-wrap"},BDV2.react.createElement("div",{className:"scrollerWrap-2uBjct content-region-scroller-wrap scrollerThemed-19vinI themeGhost-10fio9 scrollerTrack-3hhmU0"},BDV2.react.createElement("div",{className:"scroller-fzNley content-region-scroller"},BDV2.react.createElement("div",{className:"content-column default"},s.component),r.component)))))}}class V2_PublicServers{constructor(){}get component(){return BDV2.react.createElement(V2Components.Layer,{rootId:"pubslayerroot",id:"pubslayer",children:BDV2.react.createElement(V2C_PublicServers,{rootId:"pubslayerroot"})})}get root(){let a=document.getElementById("pubslayerroot");return a?a:this.injectRoot()?this.root:null}injectRoot(){return!!$(".layers, .layers-20RVFW").length&&($(".layers, .layers-20RVFW").append($("<div/>",{id:"pubslayerroot"})),!0)}render(){let a=this.root;return a?void BDV2.reactDom.render(this.component,a):void console.log("FAILED TO LOCATE ROOT: .layers")}get button(){let a=$("<div/>",{class:"guild",id:"bd-pub-li",css:{height:"20px",display:settingsCookie["bda-gs-1"]?"":"none"}}).append($("<div/>",{class:"guild-inner",css:{height:"20px","border-radius":"4px"}}).append($("<a/>",{}).append($("<div/>",{text:"public",id:"bd-pub-button",css:{"line-height":"20px","font-size":"12px"},click:()=>{this.render()}}))));return a}initialize(){let a=$(".guilds>:first-child");a.after(this.button)}}class V2C_ServerCard extends BDV2.reactComponent{constructor(a){super(a),this.state={imageError:!1,joined:this.props.guildList.includes(this.props.server.identifier)}}render(){let{server:a}=this.props;return BDV2.react.createElement("div",{className:`ui-card ui-card-primary bd-server-card${a.pinned?" bd-server-card-pinned":""}`,style:{marginTop:"5px"}},BDV2.react.createElement("div",{className:"ui-flex horizontal",style:{display:"flex",flexFlow:"row nowrap",justifyContent:"flex-start",alignItems:"stretch",flex:"1 1 auto"}},BDV2.react.createElement("div",{className:"ui-flex-child",style:{flex:"0 1 auto",padding:"5px"}},BDV2.react.createElement("img",{ref:"img",className:"bd-pubs-server-icon",src:a.icon,style:{width:"100px",height:"100px"},onError:this.handleError.bind(this)})),BDV2.react.createElement("div",{className:"ui-flex-child",style:{flex:"1 1 auto",padding:"5px"}},BDV2.react.createElement("div",{className:"ui-flex horizontal"},BDV2.react.createElement("div",{className:"ui-form-item",style:{flex:"1 1 auto"}},BDV2.react.createElement("h5",{className:"ui-form-title h5 margin-reset"},a.name)),BDV2.react.createElement("div",{className:"ui-form-item"},BDV2.react.createElement("h5",{className:"ui-form-title h5 margin-reset"},a.online,"/",a.members," Members"))),BDV2.react.createElement("div",{className:"ui-flex horizontal"},BDV2.react.createElement("div",{className:"scroller-wrap fade dark",style:{minHeight:"60px",maxHeight:"60px",borderTop:"1px solid #3f4146",borderBottom:"1px solid #3f4146",paddingTop:"5px"}},BDV2.react.createElement("div",{className:"scroller"},BDV2.react.createElement("div",{style:{fontSize:"13px",color:"#b9bbbe"}},a.description)))),BDV2.react.createElement("div",{className:"ui-flex horizontal"},BDV2.react.createElement("div",{className:"ui-flex-child bd-server-tags",style:{flex:"1 1 auto"}},a.categories.join(", ")),this.state.joined&&BDV2.react.createElement("button",{type:"button",className:"ui-button filled brand small grow disabled",style:{minHeight:"12px",marginTop:"4px",backgroundColor:"#3ac15c"}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Joined")),a.error&&BDV2.react.createElement("button",{type:"button",className:"ui-button filled brand small grow disabled",style:{minHeight:"12px",marginTop:"4px",backgroundColor:"#c13a3a"}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Error")),!a.error&&!this.state.joined&&a.invite_code&&BDV2.react.createElement("button",{type:"button",className:"ui-button filled brand small grow",style:{minHeight:"12px",marginTop:"4px"},onClick:()=>{this.join()}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Join"))))))}handleError(){this.props.server.icon=this.props.fallback,this.setState({imageError:!0})}join(){this.props.join(this.props.server),this.setState({joined:!0})}}class V2C_PublicServers extends BDV2.reactComponent{constructor(a){super(a),this.setInitialState(),this.close=this.close.bind(this),this.changeCategory=this.changeCategory.bind(this),this.search=this.search.bind(this),this.searchKeyDown=this.searchKeyDown.bind(this),this.checkConnection=this.checkConnection.bind(this),this.join=this.join.bind(this),this.GuildStore=BDV2.WebpackModules.findByUniqueProperties(["getGuilds"]),this.AvatarDefaults=BDV2.WebpackModules.findByUniqueProperties(["getUserAvatarURL","DEFAULT_AVATARS"]),this.InviteActions=BDV2.WebpackModules.findByUniqueProperties(["acceptInvite"])}componentDidMount(){this.checkConnection()}setInitialState(){this.state={selectedCategory:-1,title:"Loading...",loading:!0,servers:[],next:null,connection:{state:0,user:null}}}close(){BDV2.reactDom.unmountComponentAtNode(document.getElementById(this.props.rootId))}search(a,s){let r=this;$.ajax({method:"GET",url:`${r.endPoint}${a}`,success:o=>{console.log(o);let n=o.results.reduce((u,h)=>{return h.joined=!1,u.push(h),u},[]);s||(n=r.state.servers.concat(n));let d=o.size+o.from;d>=o.total&&(d=o.total,o.next=null);let l=`Showing 1-${d} of ${o.total} results in ${r.categoryButtons[r.state.selectedCategory]}`;r.state.term&&(l+=` for ${r.state.term}`),r.setState({loading:!1,title:l,servers:n,next:o.next}),s&&(r.refs.sbv.refs.contentScroller.refs.scroller.scrollTop=0)},error:o=>{r.setState({loading:!1,title:"Failed to load servers. Check console for details"}),console.log(o)}})}join(a){this.InviteActions.acceptInvite(a.invite_code)}get bdServer(){let s=Object.keys(this.GuildStore.getGuilds()),r=this.AvatarDefaults.DEFAULT_AVATARS;return BDV2.react.createElement(V2Components.ServerCard,{server:{name:"BetterDiscord",online:"7500+",members:"20000+",categories:["community","programming","support"],description:"Official BetterDiscord server for support etc",identifier:"86004744966914048",icon:"https://cdn.discordapp.com/icons/86004744966914048/c8d49dc02248e1f55caeb897c3e1a26e.png",nativejoin:!0,invite_code:"0Tmfo5ZbORCRqbAd",pinned:!0},pinned:!0,join:this.join,guildList:s,fallback:r[Math.floor(5*Math.random())]})}get endPoint(){return"https://search.discordservers.com"}get joinEndPoint(){return"https://join.discordservers.com"}get connectEndPoint(){return"https://join.discordservers.com/connect"}checkConnection(){let a=this;try{$.ajax({method:"GET",url:`${a.endPoint}`,success:s=>{a.setState({selectedCategory:0,connection:{state:2,user:s}}),a.search("",!0)},error:s=>{return 403===s.status||404===s.status?void a.setState({title:"Not connected to discordservers.com!",loading:!0,selectedCategory:-1,connection:{state:1,user:null}}):void console.log(s)}})}catch(s){a.setState({title:"Not connected to discordservers.com!",loading:!0,selectedCategory:-1,connection:{state:1,user:null}})}}render(){return BDV2.react.createElement(V2Components.SidebarView,{ref:"sbv",children:this.component})}get component(){return{sidebar:{component:this.sidebar},content:{component:this.content},tools:{component:BDV2.react.createElement(V2Components.Tools,{key:"pt",ref:"tools",onClick:this.close})}}}get sidebar(){return BDV2.react.createElement("div",{className:"sidebar",key:"ps"},BDV2.react.createElement("div",{className:"ui-tab-bar SIDE"},BDV2.react.createElement("div",{className:"ui-tab-bar-header",style:{fontSize:"16px"}},"Public Servers"),BDV2.react.createElement(V2Components.TabBar.Separator,null),this.searchInput,BDV2.react.createElement(V2Components.TabBar.Separator,null),BDV2.react.createElement(V2Components.TabBar.Header,{text:"Categories"}),this.categoryButtons.map((a,s)=>{return BDV2.react.createElement(V2Components.TabBar.Item,{id:s,onClick:this.changeCategory,key:s,text:a,selected:this.state.selectedCategory===s})}),BDV2.react.createElement(V2Components.TabBar.Separator,null),this.footer))}get searchInput(){return BDV2.react.createElement("div",{className:"ui-form-item"},BDV2.react.createElement("div",{className:"ui-text-input flex-vertical",style:{width:"172px",marginLeft:"10px"}},BDV2.react.createElement("input",{ref:"searchinput",onKeyDown:this.searchKeyDown,onChange:()=>{},type:"text",className:"input default",placeholder:"Search...",maxLength:"50"})))}searchKeyDown(a){let s=this;if(!(s.state.loading||13!==a.which)){s.setState({loading:!0,title:"Loading...",term:a.target.value});let r=`?term=${a.target.value}`;0!==s.state.selectedCategory&&(r+=`&category=${s.categoryButtons[s.state.selectedCategory]}`),s.search(r,!0)}}get categoryButtons(){return["All","FPS Games","MMO Games","Strategy Games","Sports Games","Puzzle Games","Retro Games","Party Games","Tabletop Games","Sandbox Games","Simulation Games","Community","Language","Programming","Other"]}changeCategory(a){let s=this;if(!s.state.loading)return s.refs.searchinput.value="",s.setState({loading:!0,selectedCategory:a,title:"Loading...",term:null}),0===a?void s.search("",!0):void s.search(`?category=${s.categoryButtons[a]}`,!0)}get content(){let a=this,s=Object.keys(this.GuildStore.getGuilds()),r=this.AvatarDefaults.DEFAULT_AVATARS;return 1===a.state.connection.state?a.notConnected:[BDV2.react.createElement("div",{ref:"content",key:"pc",className:"content-column default"},BDV2.react.createElement(V2Components.SettingsTitle,{text:a.state.title}),a.bdServer,a.state.servers.map((o,n)=>{return BDV2.react.createElement(V2Components.ServerCard,{key:n,server:o,join:a.join,guildList:s,fallback:r[Math.floor(5*Math.random())]})}),a.state.next&&BDV2.react.createElement("button",{type:"button",onClick:()=>{a.state.loading||(a.setState({loading:!0}),a.search(a.state.next,!1))},className:"ui-button filled brand small grow",style:{width:"100%",marginTop:"10px",marginBottom:"10px"}},BDV2.react.createElement("div",{className:"ui-button-contents"},a.state.loading?"Loading":"Load More")),0<a.state.servers.length&&BDV2.react.createElement(V2Components.SettingsTitle,{text:a.state.title}))]}get footer(){return BDV2.react.createElement("div",{className:"ui-tab-bar-header"},BDV2.react.createElement("a",{href:"https://discordservers.com",target:"_blank"},"Discordservers.com"))}}